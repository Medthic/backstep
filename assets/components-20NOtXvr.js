import{r as l,j as e,L as Y,c as ve,d as Ce,C as Ee,f as K,e as we,g as ke,s as Se,M as Ae,H as ye,I as _e,S as ce}from"./vendor-C-Fwtnnb.js";const Ie=()=>{const[n,t]=l.useState(new Date);l.useEffect(()=>{const i=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(i)},[]);const c=i=>i.toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});return e.jsx("div",{className:"clock",children:c(n)})},Te=({onToggle:n})=>{const[t,c]=l.useState(!1),i=()=>{c(!t),n(!t)};return e.jsxs("div",{className:"nav-menu-container",children:[e.jsxs("button",{className:`nav-menu-button ${t?"open":""}`,onClick:i,"aria-label":"Toggle menu",children:[e.jsx("span",{className:"line"}),e.jsx("span",{className:"line"}),e.jsx("span",{className:"line"})]}),t&&e.jsxs("nav",{className:"nav-menu",children:[e.jsx(Y,{to:"/",onClick:i,children:"Home"}),e.jsx(Y,{to:"/edit-assignments",onClick:i,children:"Assignments"}),e.jsx(Y,{to:"/admin",onClick:i,children:"Admin"})]})]})};function De(n){if(n%100>=11&&n%100<=13)return"th";switch(n%10){case 1:return"st";case 2:return"nd";case 3:return"rd";default:return"th"}}function Me({date:n}){const t=n?new Date(n):new Date,c=t.toLocaleDateString(void 0,{month:"short"}).toUpperCase(),i=t.getDate(),a=De(i);return e.jsxs("span",{className:"nav-date",children:[c," ",i,e.jsx("sup",{style:{fontSize:"0.5em"},children:a})]})}const es=()=>{const[n,t]=l.useState(!1);return e.jsx("nav",{className:"navbar",children:e.jsx("div",{className:"navbar-container",children:e.jsxs("div",{className:"navbar-content",children:[e.jsxs("div",{className:"navbar-left",children:[e.jsx(Ie,{}),e.jsx(Me,{})]}),e.jsx(Te,{onToggle:t})]})})})},Fe="https://lhprwuhcbqkdxgpftbmo.supabase.co",Re="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxocHJ3dWhjYnFrZHhncGZ0Ym1vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxMzg5ODUsImV4cCI6MjA2MjcxNDk4NX0.AH4rkivKT9PK00Ya_CYPxvc_Q2xQtQfzaGNWzc8sszs",N=ve(Fe,Re),ss=({duration:n=4e3})=>{const[t,c]=l.useState(""),[i,a]=l.useState(!1);return l.useEffect(()=>{const u=async()=>{const{data:j}=await N.from("sliding_messages").select("message").order("created_at",{ascending:!1}).limit(1).single();j&&(c(j.message),a(!0),setTimeout(()=>a(!1),n))};u();const h=N.channel("realtime:sliding_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"sliding_messages"},u).on("postgres_changes",{event:"UPDATE",schema:"public",table:"sliding_messages"},u).subscribe();return()=>{N.removeChannel(h)}},[n]),e.jsx("div",{className:"sliding-message-bar",children:e.jsx("div",{className:`sliding-message${i?" show":""}`,children:t})})},A={CHIEF:{background:"#f2f3f4",color:"#222"},CHIEFEMT:{background:"#f2f3f4",color:"#222"},CHIEFMEDIC:{background:"#f2f3f4",color:"#222"},CAPTAIN:{background:"#ce2029",color:"#fff"},CAPTAINEMT:{background:"#ce2029",color:"#fff"},CAPTAINMEDIC:{background:"#ce2029",color:"#fff"},LIEUTENANT:{background:"#f9b233",color:"#222"},LIEUTENANTEMT:{background:"#f9b233",color:"#222"},LIEUTENANTMEDIC:{background:"#f9b233",color:"#222"},ENGINEER:{background:"#FFD700",color:"#222"},ENGINEEREMT:{background:"#FFD700",color:"#222"},ENGINEERMEDIC:{background:"#FFD700",color:"#222"},FIREFIGHTER:{background:"#375365",color:"#dfddc4"},FIREFIGHTEREMT:{background:"#375365",color:"#dfddc4"},FIREFIGHTERMEDIC:{background:"#375365",color:"#dfddc4"},GREENSHIELD:{background:"#6bf178",color:"#222"},EMT:{background:"#2eccca",color:"#222"},AEMT:{background:"#4099ffff",color:"#222"},PARAMEDIC:{background:"#8e7cc3",color:"#222"}};function M(n){if(!n)return"";const t=String(n).toUpperCase();if(t==="PARAMEDIC")return"Paramedic";if(t==="EMT")return"EMT";if(t==="AEMT")return"A-EMT";if(t==="FIREFIGHTEREMT")return"Firefighter | EMT";if(t==="FIREFIGHTERMEDIC")return"Firefighter | MEDIC";if(t.endsWith("EMT")){const i=t.slice(0,-3);return`${i.toLowerCase()?i.toLowerCase().charAt(0).toUpperCase()+i.toLowerCase().slice(1):i} | EMT`}if(t.endsWith("MEDIC")){const i=t.slice(0,-5);return`${i.toLowerCase()?i.toLowerCase().charAt(0).toUpperCase()+i.toLowerCase().slice(1):i} | MEDIC`}const c=t.toLowerCase();return c.charAt(0).toUpperCase()+c.slice(1)}const Le=()=>{const n=["Engine 41","Engine 42","Truck","Rescue","Ambulance 47","Ambulance 48","Ambulance 49"],t=[["CHAUFFEUR","OFFICER","NOZZLE","LAYOUT","FORCIBLE ENTRY","BACKUP"],["CHAUFFEUR","OFFICER","NOZZLE","LAYOUT","FORCIBLE ENTRY","BACKUP"],["CHAUFFEUR","OFFICER","OVM","IRONS","ROOF","CAN"],["CHAUFFEUR","OFFICER","SAFETY","TOOL","CRIB","CRIB"],["STAFF","STAFF"],["STAFF","STAFF"],["STAFF","STAFF"]],[c,i]=l.useState([]),[a,u]=l.useState([]);l.useEffect(()=>{let j=!1;const b=()=>N.from("assignments").select("box, position, member_id").then(({data:m})=>{j||i(m||[])});b(),N.from("memberlist").select("id, name, rank").then(({data:m})=>{j||u(m||[])});const p=N.channel("realtime-assignments").on("postgres_changes",{event:"*",schema:"public",table:"assignments"},()=>{b()}).subscribe();return()=>{j=!0,N.removeChannel(p)}},[]);const h=j=>a.find(b=>b.id===j);return e.jsxs("div",{className:"carousel-page assignment-grid ambulance-layout",children:[n.slice(0,4).map((j,b)=>e.jsxs("div",{className:"assignment-box",children:[e.jsx("h3",{children:j}),t[b].map((p,m)=>{var g,C;const v=c.find(d=>d.box===b&&d.position===m),r=v?h(v.member_id):null;return e.jsxs("div",{className:"assignment-row vertical-align",children:[e.jsx("div",{className:"position-label left-align",children:p}),e.jsx("div",{className:r?`member-selection-box rank-${((g=r.rank)==null?void 0:g.toLowerCase())||"default"}`:"member-selection-box unassigned",style:r&&A[(C=r.rank)==null?void 0:C.toUpperCase()]?{background:A[r.rank.toUpperCase()].background,color:A[r.rank.toUpperCase()].color}:void 0,children:r?e.jsxs("span",{children:[e.jsx("span",{className:"member-name",children:r.name})," ",e.jsx("span",{className:"member-rank",children:M(r.rank)})]}):e.jsx("span",{children:"Unassigned"})})]},m)})]},b)),e.jsx("div",{className:"ambulance-stack",children:n.slice(4).map((j,b)=>e.jsxs("div",{className:"assignment-box ambulance-box",children:[e.jsx("h3",{children:j}),t[b+4].map((p,m)=>{var g,C;const v=c.find(d=>d.box===b+4&&d.position===m),r=v?h(v.member_id):null;return e.jsxs("div",{className:"assignment-row vertical-align",children:[e.jsx("div",{className:"position-label left-align",children:p}),e.jsx("div",{className:r?`member-selection-box rank-${((g=r.rank)==null?void 0:g.toLowerCase())||"default"}`:"member-selection-box unassigned",style:r&&A[(C=r.rank)==null?void 0:C.toUpperCase()]?{background:A[r.rank.toUpperCase()].background,color:A[r.rank.toUpperCase()].color}:void 0,children:r?e.jsxs("span",{children:[e.jsx("span",{className:"member-name",children:r.name})," ",e.jsx("span",{className:"member-rank",children:M(r.rank)})]}):e.jsx("span",{children:"Unassigned"})})]},m)})]},b+4))})]})},Oe={"en-US":we},Ue=Ce({format:K,startOfWeek:()=>Se(new Date,{weekStartsOn:0}),getDay:ke,locales:Oe}),Pe="ca0a5ef337ea062aef476550d3c7073c848e8499b2c4a965cc23a7f448ea2bd1@group.calendar.google.com",$e="AIzaSyCCVDsg9pIi8DcGW8S2GvfwuOgHlDVRA1Y";function He({event:n}){const t=n.allDay,c=t?null:K(n.start,"HH:mm"),i=t?null:K(n.end,"HH:mm");return e.jsxs("span",{style:{fontSize:"0.85rem",lineHeight:1.2},children:[!t&&e.jsxs("span",{style:{fontWeight:500,marginRight:3},children:[c,i&&`-${i} `]}),n.title]})}function Be({label:n}){return e.jsx("div",{className:"rbc-toolbar",style:{justifyContent:"center",display:"flex"},children:e.jsx("span",{className:"rbc-toolbar-label",children:n})})}const ze=()=>{const[n,t]=l.useState([]);return l.useEffect(()=>{fetch(`https://www.googleapis.com/calendar/v3/calendars/${Pe}/events?key=${$e}&singleEvents=true&orderBy=startTime`).then(c=>c.json()).then(c=>{if(!c.items)return;const i=c.items.filter(a=>a.start&&(a.start.dateTime||a.start.date)).map(a=>{var u,h;return{id:a.id,title:a.summary,start:new Date(a.start.dateTime||a.start.date),end:new Date(((u=a.end)==null?void 0:u.dateTime)||((h=a.end)==null?void 0:h.date)||a.start.dateTime||a.start.date),allDay:!a.start.dateTime}});t(i)})},[]),e.jsx("div",{className:"carousel-page calendar-page",style:{height:"100%",width:"100%"},children:e.jsx(Ee,{localizer:Ue,events:n,startAccessor:"start",endAccessor:"end",style:{height:"100%",width:"100%"},popup:!0,views:["month"],defaultView:"month",toolbar:!0,components:{event:He,toolbar:Be}})})},Ge="1g_BfPk42Cy83PTkVGlAyxC3w5g9MUQXVHyO-I7VA2rE",We="AIzaSyAqBIZ19jFidOeEii80p_EQSzRtBltLwlc",Z=async n=>{const t=`https://sheets.googleapis.com/v4/spreadsheets/${Ge}/values/${n}?key=${We}`,i=await(await fetch(t)).json();return n==="Status"?i.values?i.values.slice(1):[]:n==="RunStats"?i.values?i.values.slice(1).map(a=>[a[0],a[1]]):[]:i.values?i.values.slice(1).map(a=>[a[0],a[1],a[2]]):[]};function qe(){const[n,t]=l.useState({departmentNews:[],runStats:[],toolsStatus:[]});l.useEffect(()=>{async function u(){const[h,j,b]=await Promise.all([Z("DepartmentNews"),Z("RunStats"),Z("Status")]);t({departmentNews:h,runStats:j,toolsStatus:b})}u()},[]);const c=u=>{if(!u)return"";const h=u.toLowerCase();return h.includes("in service")?"status-in":h.includes("out")?"status-out":h.includes("maintenance")?"status-maint":"status-other"},i=u=>{const h=u.toLowerCase();return h.includes("fire")?"run-stat-fire":h.includes("ems")?"run-stat-ems":"run-stat-other"},a=u=>{if(!u)return null;const h=u.toLowerCase();return h==="important"?e.jsx(Ae,{className:"news-icon important"}):h==="policy change"?e.jsx(ye,{className:"news-icon policy"}):h==="general"?e.jsx(_e,{className:"news-icon general"}):null};return e.jsxs("div",{className:"info-full-container",children:[e.jsxs("div",{className:"info-col",children:[e.jsx("h2",{children:"Department News"}),e.jsx("ul",{children:n.departmentNews.map((u,h)=>{const[j,b,p]=u;return e.jsx("li",{children:e.jsxs("div",{className:"info-item news-item news-flex",children:[e.jsxs("div",{className:"news-content",children:[e.jsx("div",{children:j}),b&&e.jsx("div",{className:"news-date",children:b})]}),e.jsx("div",{className:"news-icon-container",children:a(p)})]})},h)})})]}),e.jsxs("div",{className:"info-col",children:[e.jsx("h2",{children:"Run Statistics"}),e.jsx("div",{className:"run-stats-grid",children:n.runStats.map((u,h)=>{const[j,b]=u;return e.jsxs("div",{className:`run-stat-item ${i(b)}`,children:[e.jsx("div",{className:"run-stat-title",children:b}),e.jsx("div",{className:"run-stat-number",style:{fontWeight:"bold"},children:j})]},h)})})]}),e.jsxs("div",{className:"info-col",children:[e.jsx("h2",{children:"Tools & Equipment Status"}),e.jsx("ul",{children:n.toolsStatus.map((u,h)=>{const[j,b]=u;return e.jsx("li",{children:e.jsxs("div",{className:`info-item status-item ${c(b)}`,children:[e.jsx("span",{className:"status-tool",children:j}),e.jsx("span",{className:"status-label",children:b})]})},h)})})]})]})}const D=[{key:"assignment",node:e.jsx(Le,{},"assignment")},{key:"calendar",node:e.jsx(ze,{},"calendar")},{key:"information",node:e.jsx(qe,{},"information")}],as=()=>{const[n,t]=l.useState(0),[c,i]=l.useState(!1),[a,u]=l.useState(D.map(r=>r.node)),h=l.useRef(null),j=l.useRef(null),b=700,p=1e4,m=r=>{if(!r)return D.map(d=>d.node);const g=Object.keys(r).filter(d=>r[d]),C=D.filter(d=>g.includes(d.key));return C.length?C.map(d=>d.node):D.map(d=>d.node)};l.useEffect(()=>{let r=null;async function g(){try{const{data:d,error:E}=await N.from("carousel_settings").select("config").limit(1).single();!E&&d&&d.config?u(m(d.config)):u(D.map(y=>y.node))}catch{u(D.map(d=>d.node))}try{r=N.channel("realtime:carousel_settings").on("postgres_changes",{event:"INSERT",schema:"public",table:"carousel_settings"},d=>{var y;const E=(y=d==null?void 0:d.new)==null?void 0:y.config;E&&(u(m(E)),t(0))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"carousel_settings"},d=>{var y;const E=(y=d==null?void 0:d.new)==null?void 0:y.config;E&&(u(m(E)),t(0))}).subscribe()}catch{}}const C=()=>{try{g()}catch{}};return g(),window.addEventListener("carouselPagesChanged",C),()=>{r&&N.removeChannel(r),window.removeEventListener("carouselPagesChanged",C)}},[]),l.useEffect(()=>((()=>{h.current=setTimeout(()=>{a.length<=1||(i(!0),j.current=setTimeout(()=>{t(g=>(g+1)%a.length),i(!1)},b))},p)})(),()=>{clearTimeout(h.current),clearTimeout(j.current)}),[n,a]);const v=(n+1)%a.length;return e.jsx("div",{className:"carousel",children:e.jsx("div",{className:"carousel-track",children:a.map((r,g)=>{const C=g===n&&!c,d=c&&g===n,E=c&&g===v,P=["carousel-page",C?"active":"",d?"outgoing":"",E?"incoming":"",!C&&!d&&!E?"hidden":""].join(" ").trim();return e.jsx("div",{className:P,children:r},`page-${g}`)})})})},Ve={ENGINE_41:{name:"Engine 41",positions:["Driver","Officer","Nozzle","Backup","Bar","Layout"]},ENGINE_42:{name:"Engine 42",positions:["Driver","Officer","Nozzle","Backup","Bar","Layout"]},TRUCK:{name:"Truck",positions:["Driver","Officer","OVM","Roof","Bar","Can"]},RESCUE:{name:"Rescue",positions:["Driver","Officer","Safety","Crib","Crib","Tool"]}},Ye=[47,48,49].map(n=>({name:`Ambulance ${n}`,positions:["Staff","Staff"]})),Ze=({value:n,onChange:t,options:c,isDisabled:i})=>e.jsx(ce,{className:"member-select",value:c.find(a=>a.value===n)||null,onChange:a=>t((a==null?void 0:a.value)||null),options:c,isClearable:!0,isSearchable:!0,isDisabled:i,styles:{option:(a,u)=>({...a,color:"#222",backgroundColor:u.data.color,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),singleValue:a=>({...a,color:"#222",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"}),valueContainer:a=>({...a,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}),menu:a=>({...a,zIndex:9999}),menuList:a=>({...a,maxHeight:"220px"})}}),oe=({name:n,positions:t,boxIdx:c,onAssign:i,memberOptions:a,savingMap:u,getAssignment:h})=>e.jsxs("div",{className:"assignment-box",children:[e.jsx("h3",{children:n}),t.map((j,b)=>e.jsxs("div",{className:"assignment-row vertical-align",children:[e.jsx("div",{className:"position-label left-align",children:j}),e.jsx(Ze,{value:h(c,b),onChange:p=>i(c,b,p),options:a,isDisabled:!!u[`${c}-${b}`]})]},b))]}),ts=()=>{const[n,t]=l.useState([]),[c,i]=l.useState([]),[a,u]=l.useState({});l.useEffect(()=>{(async()=>{const[v,r]=await Promise.all([N.from("assignments").select("box, position, member_id"),N.from("memberlist").select("id, name, rank")]);t(v.data||[]),i(r.data||[])})();let m=null;try{m=N.channel("realtime:assignments").on("postgres_changes",{event:"*",schema:"public",table:"assignments"},v=>{const{eventType:r}=v;if(r==="INSERT"||r==="UPDATE"){const g=v.new;t(C=>[...C.filter(E=>!(E.box===g.box&&E.position===g.position)),{box:g.box,position:g.position,member_id:g.member_id}])}else if(r==="DELETE"){const g=v.old;t(C=>C.filter(d=>!(d.box===g.box&&d.position===g.position)))}}).subscribe()}catch{}return()=>{m&&N.removeChannel(m)}},[]);const h=l.useMemo(()=>c.map(p=>{var m;return{value:p.id,label:`${p.name} (${p.rank})`,color:((m=A[p.rank])==null?void 0:m.background)||"#fff"}}),[c]),j=(p,m)=>{var v;return((v=n.find(r=>r.box===p&&r.position===m))==null?void 0:v.member_id)||""},b=async(p,m,v)=>{const r=`${p}-${m}`;u(g=>({...g,[r]:!0}));try{v===null?(await N.from("assignments").delete().eq("box",p).eq("position",m),t(g=>g.filter(C=>!(C.box===p&&C.position===m)))):(await N.from("assignments").upsert({box:p,position:m,member_id:v},{onConflict:["box","position"]}),t(g=>[...g.filter(d=>!(d.box===p&&d.position===m)),{box:p,position:m,member_id:v}]))}catch(g){console.error("Error updating assignment:",g)}u(g=>{const C={...g};return delete C[r],C})};return e.jsx("div",{className:"assignment-edit-page",children:e.jsxs("div",{className:"assignment-grid",children:[Object.values(Ve).map(({name:p,positions:m},v)=>e.jsx(oe,{name:p,positions:m,boxIdx:v,onAssign:b,memberOptions:h,savingMap:a,getAssignment:j},v)),e.jsx("div",{className:"ambulance-stack",children:Ye.map(({name:p,positions:m},v)=>e.jsx(oe,{name:p,positions:m,boxIdx:v+4,onAssign:b,memberOptions:h,savingMap:a,getAssignment:j,className:"ambulance-box"},v+4))})]})})},ns=()=>{const[n,t]=l.useState(""),[c,i]=l.useState(!1),[a,u]=l.useState(""),[h,j]=l.useState(""),[b,p]=l.useState(""),[m,v]=l.useState(""),[r,g]=l.useState(""),[C,d]=l.useState(""),[E,y]=l.useState([]),[P,$]=l.useState(!1),[I,H]=l.useState(null),[J,F]=l.useState(""),[Ke,R]=l.useState(""),[Je,Qe]=l.useState(!1),[T,Q]=l.useState({show:!1,message:"",type:""}),[X,ee]=l.useState(()=>{try{return localStorage.getItem("admin_actor")||null}catch{return null}}),[B,de]=l.useState(null),[L,me]=l.useState(null),O={assignment:!0,calendar:!0,information:!0},[z,U]=l.useState(O),[se,G]=l.useState(null),ae=Object.keys(A).map(s=>({value:s,label:M(s),color:A[s].background,textColor:A[s].color})),te=Object.keys(A);l.useEffect(()=>{c&&N.from("memberlist").select("id, name, rank").then(({data:o})=>y(o||[])),(async()=>{try{const{data:o,error:x}=await N.from("carousel_settings").select("id, config").limit(1).single();!x&&o&&o.config?(U(o.config),G(o.id)):U(O)}catch{U(O),w("Could not load carousel settings from server","error")}})()},[c,C]);const w=(s,o="info",x=2e3)=>{Q({show:!0,message:s,type:o}),setTimeout(()=>Q({show:!1,message:"",type:""}),x)},ue=()=>{if(L)return L;if(B)return B;if(X)return X;try{let s=localStorage.getItem("admin_actor");if(s)return ee(s),s;const o=typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`anon-${Date.now()}-${Math.floor(Math.random()*1e4)}`;try{localStorage.setItem("admin_actor",o)}catch{}return ee(o),o}catch{return null}},k=async(s,o={})=>{try{const x=ue(),f=L||x||null,S={...o,admin:{id:B||null,name:L||x||null}},{error:_}=await N.rpc("insert_admin_audit",{p_actor:f,p_action:s,p_details:S});_&&await N.from("admin_audit").insert([{actor:f,action:s,details:S}])}catch{}},ge=async s=>{s.preventDefault(),u("");try{const{data:o,error:x}=await N.from("admins").select("id, name").eq("passcode",n).limit(1).single();if(x||!o){w("Incorrect passcode.","error"),k("login_failed",{reason:"incorrect_passcode"});return}i(!0),t(""),de(o.id),me(o.name||null),w("Login successful!","success"),k("login",{success:!0,admin:{id:o.id,name:o.name}})}catch{w("Error connecting to server.","error"),k("login_failed",{reason:"server_error"})}},he=async s=>{s.preventDefault(),p("");const{data:o}=await N.from("sliding_messages").select("id").limit(1).single();if(o){const x=o.id,{error:f}=await N.from("sliding_messages").update({message:h}).eq("id",x);f?(w("Failed to update message.","error"),k("update_message_failed",{error:f.message||"unknown"})):(w("Message updated!","success"),k("update_message",{message:h}))}else w("Could not find message row.","error"),k("update_message_failed",{error:"no_message_row"})},fe=async s=>{s.preventDefault(),d("");const{error:o}=await N.from("memberlist").insert([{name:m,rank:r}]);if(o)w("Failed to add member.","error"),k("add_member_failed",{name:m,rank:r,error:o.message||"unknown"});else{w("Member added!","success"),k("add_member",{name:m,rank:r}),v(""),g("");const{data:x}=await N.from("memberlist").select("id, name, rank");y(x||[])}},be=s=>{H(s),$(!0),F(""),R(""),k("delete_member_initiated",{targetId:s})},[W,ne]=l.useState(null),[re,q]=l.useState(""),[ie,V]=l.useState(""),pe=s=>{ne(s.id),q(s.name),V(s.rank)},le=()=>{ne(null),q(""),V("")},xe=async s=>{const o=E.find(S=>S.id===s);if(!o)return;const x={name:re,rank:ie},{error:f}=await N.from("memberlist").update(x).eq("id",s);f?(w("Failed to update member.","error"),k("edit_member_failed",{id:s,prev:o,attempted:x,error:f.message||"unknown"})):(w("Member updated!","success"),y(S=>S.map(_=>_.id===s?{..._,...x}:_)),k("edit_member",{id:s,prev:o,next:x}),le())},Ne=async s=>{s.preventDefault(),R("");try{const{data:f,error:S}=await N.from("admins").select("id, name").eq("passcode",J).limit(1).single();if(S||!f){w("Incorrect passcode.","error"),k("delete_member_failed",{id:I,reason:"incorrect_passcode"});return}}catch{w("Error connecting to server.","error"),k("delete_member_failed",{id:I,reason:"fetch_passcode_error"});return}const o=E.find(f=>f.id===I)||{id:I},{error:x}=await N.from("memberlist").delete().eq("id",I);x?(w("Failed to delete member.","error"),k("delete_member_failed",{id:I,error:x.message||"unknown"})):(w("Member deleted!","success"),y(E.filter(f=>f.id!==I)),k("delete_member",{target:o})),$(!1),H(null),F(""),R("")},je=()=>{$(!1),H(null),F(""),R(""),k("delete_member_cancelled",{})};return c?e.jsxs("div",{className:"admin-container",children:[e.jsx("h1",{className:"admin-title",children:"Admin Dashboard"}),e.jsxs("div",{className:"admin-grid","aria-live":"polite",children:[e.jsxs("section",{className:"admin-card carousel-card","aria-labelledby":"carousel-heading",children:[e.jsx("h2",{id:"carousel-heading",className:"card-title",children:"Carousel Pages"}),e.jsx("div",{className:"carousel-toggle-row",children:Object.keys(O).map(s=>e.jsxs("label",{className:"carousel-toggle",children:[e.jsx("input",{type:"checkbox",className:"carousel-checkbox",checked:!!z[s],"aria-checked":!!z[s],"aria-label":`Toggle ${s.replace(/([A-Z])/g," $1").trim()} page`,onChange:async o=>{const x={...z,[s]:o.target.checked};U(x);try{if(se){const{data:f,error:S}=await N.from("carousel_settings").update({config:x,updated_at:new Date().toISOString()}).eq("id",se).select();if(S)throw S;(!f||Array.isArray(f)&&f.length===0)&&console.warn("carousel_settings update returned no rows but update succeeded")}else{const{data:f,error:S}=await N.from("carousel_settings").insert([{config:x}]).select();if(S)throw S;if(f&&f[0]&&f[0].id)G(f[0].id);else try{const{data:_}=await N.from("carousel_settings").select("id").limit(1).single();_!=null&&_.id&&G(_.id)}catch(_){console.warn("Fallback fetch for carousel_settings id failed",_)}}window.dispatchEvent(new Event("carouselPagesChanged")),w("Carousel updated","success",1500),k("update_carousel",{config:x})}catch(f){console.error("Failed to save carousel settings",f),w("Failed to save","error",2e3)}}}),e.jsx("span",{className:"carousel-slider","aria-hidden":"true"}),e.jsx("span",{className:"carousel-label",children:s.replace(/([A-Z])/g," $1").trim()})]},s))})]}),e.jsxs("section",{className:"admin-card message-card","aria-labelledby":"message-heading",children:[e.jsx("h2",{id:"message-heading",className:"card-title",children:"Scrolling Message"}),e.jsxs("form",{onSubmit:he,className:"stack-form","aria-label":"Update scrolling message form",children:[e.jsx("label",{htmlFor:"scrolling-message",className:"input-label",children:"Message"}),e.jsx("input",{id:"scrolling-message",className:"admin-input",type:"text",value:h,onChange:s=>j(s.target.value),placeholder:"Enter new message"}),e.jsx("button",{type:"submit",className:"admin-button","aria-label":"Update scrolling message",children:"Update"})]})]}),e.jsxs("section",{className:"admin-card add-member-card","aria-labelledby":"add-member-heading",children:[e.jsx("h2",{id:"add-member-heading",className:"card-title",children:"Add Member"}),e.jsxs("form",{className:"stack-form add-member-form",onSubmit:fe,"aria-label":"Add member form",children:[e.jsxs("div",{className:"field name-field",children:[e.jsx("label",{htmlFor:"new-member-name",className:"input-label",children:"Name"}),e.jsx("input",{id:"new-member-name",className:"admin-input",type:"text",value:m,onChange:s=>v(s.target.value),placeholder:"New member name",required:!0})]}),e.jsxs("div",{className:"field rank-field",children:[e.jsx("label",{htmlFor:"new-member-rank",className:"input-label",children:"Rank"}),e.jsx(ce,{inputId:"new-member-rank",className:"member-select",options:ae,value:ae.find(s=>s.value===r)||null,onChange:s=>g(s?s.value:""),isClearable:!0,isSearchable:!0,placeholder:"Select rank",menuPlacement:"auto",formatOptionLabel:s=>e.jsx("span",{style:{color:s.textColor,fontWeight:600},children:s.label}),styles:{option:(s,o)=>({...s,backgroundColor:o.data.color,color:o.data.textColor,fontFamily:'"BebasNeue", Arial, sans-serif',letterSpacing:"2px",fontWeight:600}),singleValue:(s,o)=>({...s,color:o.data.textColor,backgroundColor:o.data.color,fontFamily:'"BebasNeue", Arial, sans-serif',letterSpacing:"2px",padding:"2px 8px",borderRadius:"0.3em",fontWeight:600}),control:s=>({...s,backgroundColor:"#fff",color:"#222",border:"1px solid #444",fontFamily:'"BebasNeue", Arial, sans-serif',letterSpacing:"2px",minHeight:"40px"}),menu:s=>({...s,backgroundColor:"#fff",color:"#222"})}})]}),e.jsx("div",{className:"form-actions",children:e.jsx("button",{type:"submit",className:"admin-button",disabled:!m||!r,"aria-disabled":!m||!r,children:"Add Member"})})]})]})]}),e.jsxs("section",{className:"admin-table-wrapper admin-card","aria-labelledby":"members-heading",children:[e.jsx("h2",{id:"members-heading",className:"card-title",children:"Members"}),e.jsx("div",{className:"admin-table-container",children:e.jsxs("table",{className:"admin-table","aria-label":"Members list",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"Name"}),e.jsx("th",{scope:"col",children:"Rank"}),e.jsx("th",{scope:"col","aria-label":"Actions"})]})}),e.jsx("tbody",{children:E.slice().sort((s,o)=>{const x=te.indexOf(s.rank),f=te.indexOf(o.rank);return x===-1&&f===-1?0:x===-1?1:f===-1?-1:x-f}).map(s=>{var o,x;return e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Name",children:W===s.id?e.jsx("input",{className:"admin-input",value:re,onChange:f=>q(f.target.value),"aria-label":"Edit member name"}):s.name}),e.jsx("td",{"data-label":"Rank",children:W===s.id?e.jsxs("select",{className:"admin-input",value:ie,onChange:f=>V(f.target.value),"aria-label":"Edit member rank",children:[e.jsx("option",{value:"",children:"Select rank"}),Object.keys(A).map(f=>e.jsx("option",{value:f,children:M(f)},f))]}):e.jsx("span",{className:"rank-badge",style:{background:(o=A[s.rank])==null?void 0:o.background,color:(x=A[s.rank])==null?void 0:x.color},children:M(s.rank)})}),e.jsx("td",{"data-label":"Actions",children:W===s.id?e.jsxs("div",{className:"action-group",children:[e.jsx("button",{className:"admin-button sm",onClick:()=>xe(s.id),"aria-label":"Save member changes",children:"Save"}),e.jsx("button",{className:"admin-button sm",onClick:le,"aria-label":"Cancel member edit",children:"Cancel"})]}):e.jsxs("div",{className:"action-group",children:[e.jsx("button",{className:"admin-button sm",onClick:()=>pe(s),style:{minWidth:60},"aria-label":`Edit ${s.name}`,children:"Edit"}),e.jsx("button",{className:"admin-button sm danger",onClick:()=>be(s.id),"aria-label":`Delete ${s.name}`,children:"Delete"})]})})]},s.id)})})]})})]}),P&&e.jsx("div",{className:"admin-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"delete-heading",children:e.jsxs("div",{className:"admin-modal",children:[e.jsx("h3",{id:"delete-heading",children:"Confirm Delete"}),e.jsx("p",{children:"Enter your 4-digit passcode to confirm deletion:"}),e.jsxs("form",{onSubmit:Ne,"aria-label":"Confirm delete member form",children:[e.jsx("label",{htmlFor:"delete-passcode",className:"visually-hidden",children:"Passcode"}),e.jsx("input",{id:"delete-passcode",type:"password",inputMode:"numeric",pattern:"\\d{4}",maxLength:4,value:J,onChange:s=>F(s.target.value.replace(/\D/g,"")),className:"admin-input",placeholder:"4-digit passcode",required:!0,autoFocus:!0}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"submit",className:"admin-button danger","aria-label":"Confirm deletion",children:"Confirm Delete"}),e.jsx("button",{type:"button",className:"admin-button",onClick:je,"aria-label":"Cancel deletion",children:"Cancel"})]})]})]})}),T.show&&e.jsx("div",{className:`admin-popup ${T.type}`,children:T.message})]}):e.jsxs("div",{className:"admin-container admin-login",children:[e.jsx("h1",{className:"admin-title",children:"Admin Login"}),e.jsxs("form",{onSubmit:ge,className:"admin-form","aria-label":"Admin login form",children:[e.jsx("label",{htmlFor:"admin-passcode",className:"visually-hidden",children:"Passcode"}),e.jsx("input",{id:"admin-passcode",type:"password",inputMode:"numeric",pattern:"\\d{4}",maxLength:4,value:n,onChange:s=>t(s.target.value.replace(/\D/g,"")),placeholder:"4-digit passcode",className:"admin-input",required:!0,"aria-required":"true"}),e.jsx("button",{type:"submit",className:"admin-button","aria-label":"Login",children:"Login"})]}),T.show&&e.jsx("div",{className:`admin-popup ${T.type}`,children:T.message})]})};export{ts as A,as as P,ss as S,es as T,ns as a};
